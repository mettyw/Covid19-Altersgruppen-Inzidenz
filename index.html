<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Zeitreihe Inzidenz pro Altersgruppe</title>
    <meta content="" name="description">
    <meta content="COVID-19, CORONA, DEUTSCHLAND, ALTERSGRUPPEN, INZIDENZ, LANDKREIS" name="keywords">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  
    <!-- Bootstrap CSS -->
    <!-- <link href="assets/css/bootstrap/bootstrap.min.css" rel="stylesheet">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

  
    <!-- Master CSS -->
    <link href="assets/css/main.css" rel="stylesheet">
  
</head>

<body>
    <h1>Zeitreihe Inzidenz pro Altersgruppe</h1>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
 
    <div id="controls">
        <label for="landkreiseOptions" class="form-label">Landkreis</label>
        <select id="landkreiseOptions" class="form-select" aria-label="Default select example"
          onChange="landkreisSelected(this);"
          >
            <option selected>(bitte ausw&auml;len)</option>
          </select>
<!--
          <label for="landkreise" class="form-label">Landkreis</label>
          <input class="form-control" list="landkreiseOptions" id="landkreise" placeholder="Type to search...">
          <datalist id="landkreiseOptions">
            <option value="San Francisco">
            <option value="New York">
            <option value="Seattle">
            <option value="Los Angeles">
            <option value="Chicago">
          </datalist>  
          -->
    </div>
    <div id="chart"></div> 
</body>

<script>

// Visualization API with the Line chart package.
    google.charts.load('current', { packages: ['line'] });
    google.charts.setOnLoadCallback(loadData);
    
    var mydata;

    function landkreisSelected(sel) {
        var lk_id = sel.options[sel.selectedIndex].value;
       // alert(lk_id);
        drawChart(lk_id);
    }
    function loadData() {
        $.ajax({
            url: "assets/data/data_latest.json",
            dataType: "json",
            type: "GET",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                mydata = data

                $.each(data['landkreise'], function(key, value) {
                    $('#landkreiseOptions').append($('<option>').text(value).attr('value', key));
                });

            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Got an Error');
            }
        });
    }

    function drawChart(lk_id) {
                var dataSeries = [['date', 'A00-A04', 'A05-A14', 'A15-A34', 'A35-A59', 'A60-A79', 'A80+', 'unbekannt']];    // Define an array and assign columns for the chart.

                //data = data['incidence']['9564']

                // Loop through each data and populate the array.
                $.each(mydata['incidence'][lk_id], function (index, value) {
                    dataSeries.push(
                        [
                         value.date, 
                         value['A00-A04'], 
                         value['A05-A14'], 
                         value['A15-A34'], 
                         value['A35-A59'], 
                         value['A60-A79'], 
                         value['A80+'],
                         value['unknown']
                        ]);
                });

                // Set chart Options.
                var options = {
                    chart: {
                        title: 'Monthly Cases',
                        subtitle: '-- grouped by age group',
                    },

                };
                // Create DataTable and add the array to it.
                var data = google.visualization.arrayToDataTable(dataSeries)

                // Define the chart type (LineChart) and the container (a DIV in our case).
                var chart = new google.charts.Line(document.getElementById('chart'))

                // Draw the chart with Options.
                chart.draw(data, google.charts.Line.convertOptions(options));                
            }
</script>
</html>
